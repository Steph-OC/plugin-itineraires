document.addEventListener("DOMContentLoaded",(function(){const t=pluginDirUrl.buttonColor,e=pluginDirUrl.buttonTextColor,o=pluginDirUrl.buttonHoverColor,n=pluginDirUrl.buttonFocusColor,r=document.getElementById("copy-shortcode"),i=document.getElementById("trail-map-shortcode");r&&i&&r.addEventListener("click",(function(){const t=document.createRange();t.selectNode(i),window.getSelection().removeAllRanges(),window.getSelection().addRange(t);try{document.execCommand("copy")&&alert("Shortcode copié dans le presse-papiers !")}catch(t){}window.getSelection().removeAllRanges()}));const a=document.querySelector(".plugin-section-title");if(a){const t=pluginDirUrl.sectionTitleColor;a.style.color=t}if(!document.getElementById("map"))return;const l=pluginDirUrl.url,c=L.map("map").setView([mapSettings.latitude,mapSettings.longitude],mapSettings.zoom);L.tileLayer("https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png",{maxZoom:20,attribution:'&copy; OpenStreetMap France | &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(c),void 0!==L.control.fullscreen&&c.addControl(new L.control.fullscreen);let s=[],d=[];function u(t){fetch(t).then((t=>{if(!t.ok)throw new Error("Network response was not ok "+t.statusText);return t.text()})).then((t=>{const e=(new DOMParser).parseFromString(t,"application/xml"),o=l+"leaflet/images/pin-icon-start.png",n=l+"leaflet/images/pin-icon-end.png",r=l+"leaflet/images/marker-shadow.png",i=l+"leaflet/images/pin-icon-wpt.png",a=new L.GPX(e.documentElement.outerHTML,{async:!0,marker_options:{startIconUrl:o,endIconUrl:n,shadowUrl:r,wptIconUrls:{"":i}},polyline_options:{color:"red",weight:5,opacity:1,smoothFactor:1}}).on("loaded",(function(t){c.fitBounds(t.target.getBounds())}));s.push(a),a.addTo(c);const u=e.getElementsByTagName("wpt");Array.from(u).forEach(((t,e)=>{const o=t.getAttribute("lat"),n=t.getAttribute("lon"),r=t.getElementsByTagName("name")[0].textContent,i=t.getElementsByTagName("desc")[0]?t.getElementsByTagName("desc")[0].textContent:"",a=L.divIcon({className:"waypoint-icon",html:`<div style="position: relative;"><i class="fa fa-map-marker" aria-hidden="true"></i><span style="position: absolute; top: 0; left: 0; transform: translate(-50%, -50%);">${e+1}</span></div>`,iconSize:[30,42],iconAnchor:[15,42]}),l=L.marker([o,n],{icon:a}).addTo(c).bindPopup(`<b>${r}</b><br>${i}`);d.push(l)}))})).catch((t=>{}))}function g(){s.forEach((t=>c.removeLayer(t))),s=[],d.forEach((t=>c.removeLayer(t))),d=[]}document.querySelectorAll(".show-trail").forEach((function(r){r.style.backgroundColor=t,r.style.color=e,r.addEventListener("mouseover",(function(){r.style.backgroundColor=o})),r.addEventListener("mouseout",(function(){r.style.backgroundColor=t})),r.addEventListener("focus",(function(){r.style.backgroundColor=n})),r.addEventListener("blur",(function(){r.style.backgroundColor=t})),r.addEventListener("click",(function(){g(),u(r.getAttribute("data-url"));const t=r.getAttribute("data-description"),e=r.getAttribute("data-distance"),o=r.getAttribute("data-difficulty"),n=r.getAttribute("data-duration"),i=r.getAttribute("data-precautions"),a=document.getElementById("trail-description");a&&(a.innerHTML=`\n                    <h3>Informations du parcours</h3>\n                    <p><strong>Distance :</strong> ${e} km</p>\n                    <p><strong>Difficulté :</strong> ${o}</p>\n                    <p><strong>Durée :</strong> ${n}</p>\n                    <h3>Description</h3>\n                    <p>${t}</p>\n                    <p><strong>Précautions :</strong> ${i}</p>\n                `,a.style.display="block")}))}));const m=document.getElementById("show-all");m&&(m.style.backgroundColor=t,m.style.color=e,m.addEventListener("mouseover",(function(){m.style.backgroundColor=o})),m.addEventListener("mouseout",(function(){m.style.backgroundColor=t})),m.addEventListener("focus",(function(){m.style.backgroundColor=n})),m.addEventListener("blur",(function(){m.style.backgroundColor=t})),m.addEventListener("click",(function(){!function(t){g(),t.forEach((t=>u(t)))}(Array.from(document.querySelectorAll(".show-trail")).map((t=>t.getAttribute("data-url"))));const t=document.getElementById("trail-description");t&&(t.style.display="none")})));const p=document.getElementById("trail-description");let f;p&&(p.style.display="none");let y=!1,h=null;const b=L.control({position:"topright"});b.onAdd=function(t){const e=L.DomUtil.create("div","leaflet-bar leaflet-control locate-icon");return e.innerHTML='<a href="#" title="Locate me"><i class="fa fa-map-marker" aria-hidden="true"></i></a>',e.onclick=function(){return y?(h&&(navigator.geolocation.clearWatch(h),h=null),y=!1,e.querySelector("i").style.color="red",f&&(t.removeLayer(f),f=null)):(h=navigator.geolocation.watchPosition((function(e){const o=L.divIcon({className:"user-location-icon",html:'<i class="fas fa-street-view"></i>',iconSize:[30,30],iconAnchor:[15,15]});f?f.setLatLng([e.coords.latitude,e.coords.longitude]):f=L.marker([e.coords.latitude,e.coords.longitude],{icon:o}).addTo(t),t.setView([e.coords.latitude,e.coords.longitude],16)}),(function(t){alert("Erreur de localisation: "+t.message)}),{enableHighAccuracy:!0,maximumAge:0,timeout:6e4}),y=!0,e.querySelector("i").style.color="green"),!1},e},b.addTo(c)}));